---
import type { CollectionEntry } from "astro:content"

import Date from "./Date.astro"
import Image from "./Image.astro"
import Tag from "./Tag.astro"
import { formatTags, sortTags } from "@utils/helpers"
import { Icon } from "astro-icon/components"

interface Props {
    event: CollectionEntry<"events">
}

const { event } = Astro.props as Props
const { cover, coverAlt, title, role, date, description } = event.data

const dialogId = `talk-${`${ title }`.toLowerCase().replace(/\s+/g, '-')}`
---

<article class="group relative">
    <button type="button" class="w-full text-left focus:rounded-xl" aria-haspopup="dialog" aria-controls={ dialogId } onclick={`document.getElementById('${ dialogId }').showModal()`} >
        <Image src={ cover } alt={ coverAlt } />
    </button>
</article>

<dialog id={ dialogId } class="m-auto w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-xl border border-neutral-200 bg-white p-0 shadow-xl backdrop:bg-black/70 backdrop:backdrop-blur-sm">
    <button type="button" aria-label="Close" class="absolute right-4 top-4 rounded-lg p-2 text-white bg-black/60 hover:bg-black/70 transition-all duration-200 hover:scale-105" onclick={`document.getElementById('${ dialogId }').close()`} >
        <Icon name="tabler:x" />
    </button>

    <img src={ cover } alt={ coverAlt } class="w-full" />

    <div class="space-y-2 p-6">
        <h2 class="text-xl font-semibold text-neutral-900">
            { title }
        </h2>

        <p>
            ðŸ“… <Date date={ date } options={{ year: "numeric", month: "long", }} />
        </p>

        <div class="my-2 flex flex-wrap gap-2">
            {
                sortTags(formatTags(role)).map((tag) => (
                    <Tag>{ `${ tag }` }</Tag>
                ))
            }
        </div>

        <p class="text-neutral-700">
            { description }
        </p>
    </div>
</dialog>
