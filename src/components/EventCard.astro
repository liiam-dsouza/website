---
import type { CollectionEntry } from "astro:content"

import Card from "./Card.astro"
import Date from "./Date.astro"
import Image from "./Image.astro"
import Tag from "./Tag.astro"
import { formatTags } from "@utils/helpers"

interface Props {
    event: CollectionEntry<"events">
}

const { event } = Astro.props as Props
const { cover, coverAlt, title, role, date, description } = event.data

const dialogId = `talk-${`${ title + role }`.toLowerCase().replace(/\s+/g, '-')}`
---

<article class="group relative">
    <button
        type="button"
        class="w-full text-left focus:rounded-lg"
        aria-haspopup="dialog"
        aria-controls={dialogId}
        onclick={`document.getElementById('${dialogId}').showModal()`}
    >
        <Card>
            <Image src={ cover } alt={ coverAlt } />
            <span class="mt-2 text-lg font-medium">{ title }</span>
            <div class="my-2 flex flex-wrap gap-2">
                {
                    formatTags(role).sort().map((tag) => (
                        <Tag>{ `${ tag }` }</Tag>
                    ))
                }
            </div>
        </Card>
    </button>
</article>

<dialog
  id={dialogId}
  class="m-auto w-full max-w-2xl rounded-xl border border-neutral-200 bg-white p-0 shadow-xl backdrop:bg-black/70 backdrop:backdrop-blur-sm"
>
  <!-- Close -->
  <button
    type="button"
    aria-label="Close"
    class="absolute right-4 top-4 rounded-md bg-neutral-900/70 px-2 py-1 text-xl text-white hover:bg-neutral-900"
    onclick={`document.getElementById('${dialogId}').close()`}
  >
    Ã—
  </button>

  <!-- Modal image -->
  <img
    src={cover}
    alt=""
    class="w-full"
  />

  <!-- Modal content -->
  <div class="space-y-4 p-6">
    <h2 class="text-xl font-semibold text-neutral-900">
      {title}
    </h2>

    <div class="my-2 flex flex-wrap gap-2">
        {
            formatTags(role).sort().map((tag) => (
                <Tag>{ `${ tag }` }</Tag>
            ))
        }
    </div>

    <p class="text-sm text-neutral-600">
        ðŸ“… <Date date={ date } format="long" />
    </p>

    {description && (
      <p class="text-neutral-700">
        {description}
      </p>
    )}
  </div>
</dialog>
