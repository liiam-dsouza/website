---
import { getCollection, render, type CollectionEntry } from "astro:content"

import PostWrapper from "@layouts/PostWrapper.astro"

export async function getStaticPaths() {
    const posts = await getCollection("posts")

    const sortedPosts = posts.sort(
        (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
    )

    console.log(sortedPosts.map(p => p.id))

    return sortedPosts.map((post, index) => ({
        params: { id: post.id },
        props: {
            post,
            previousPost: sortedPosts[index - 1] ?? null, // newer post
            nextPost: sortedPosts[index + 1] ?? null,     // older post
        },
    }))
}

type Props = {
    post: CollectionEntry<"posts">
    previousPost: CollectionEntry<"posts"> | null
    nextPost: CollectionEntry<"posts"> | null
}

const { post, previousPost, nextPost } = Astro.props
const { Content } = await render(post)
---

<PostWrapper frontmatter={ post.data } previousPost={ previousPost } nextPost={ nextPost } post={ post }>
    <Content />
</PostWrapper>
